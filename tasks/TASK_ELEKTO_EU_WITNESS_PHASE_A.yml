task_id: ELEKTO_EU_WITNESS_PHASE_A
project_root: D:\EVE11\Projects\013_elekto_eu
intent: >
  Bootstrap Witness Mode for Sweden Energy Decisions using EVEverified evidence pipeline.
  Phase A: ingest Riksdagen document metadata (no opinions), build canonical graph inputs,
  generate manifest+sha256+root_hash, and expose minimal UI route showing evidence cards.

trinity_rules:
  - TR1: No source, no number
  - TR2: All ingests produce manifest + SHA256 + root_hash
  - TR3: Every chart/list item links to evidence record IDs
  - TR4: Model changes bump methodology version
  - TR5: Only human approves merge to main
  - TR6: Claude generates code — NEVER data values
  - TR7: Witness mode = NO interpretation (trace only)
  - TR8: Every claim must be a clickable evidence link
  - TR9: Proof Pack export must include raw+canonical+manifest+hashes

data_contracts:
  storage_layout:
    raw: data/raw/witness/riksdagen/{run_id}/
    canonical: data/canonical/witness/riksdagen/{run_id}/
    derived: data/derived/witness/riksdagen/{run_id}/
    manifests: manifests/witness/{run_id}/
  naming:
    run_id_format: "witness_riksdagen_energy_{YYYYMMDD_HHMMSSZ}"
    evidence_id_format: "evr:{source}:{dataset_id}:{run_id}:{sha256_12}"

sources_whitelist:
  - name: Riksdagen Open Data
    publisher: Riksdagen
    uri_prefix: "https://data.riksdagen.se/"
    dataset_id: "riksdagen_open_data"
    allowed: true
  - name: Svensk författningssamling
    publisher: Regeringskansliet
    uri_prefix: "https://svenskforfattningssamling.se/"
    dataset_id: "sfs"
    allowed: later_phase
  - name: Boverket
    publisher: Boverket
    uri_prefix: "https://www.boverket.se/"
    dataset_id: "boverket"
    allowed: later_phase

taxonomy_energy:
  tags:
    - ENERGY.NUCLEAR
    - ENERGY.TAXES_FEES
    - ENERGY.GRID_TRANSMISSION
    - ENERGY.MARKET_DESIGN
    - ENERGY.BUILDING_ENERGY_RULES
    - ENERGY.EU_IMPLEMENTATION
  seed_keywords:
    ENERGY.NUCLEAR: [kärnkraft, reaktor, effektskatt, strålsäkerhet, avveckling]
    ENERGY.TAXES_FEES: [energiskatt, skatt, moms, avgift, elcertifikat]
    ENERGY.GRID_TRANSMISSION: [nätavgift, stamnät, överföring, kapacitet, flaskhals]
    ENERGY.MARKET_DESIGN: [elmarknad, elområde, prisområde, kapacitetsmekanism, balansmarknad]
    ENERGY.BUILDING_ENERGY_RULES: [boverket, BBR, energihushållning, primärenergital, isolering, U-värde]
    ENERGY.EU_IMPLEMENTATION: [direktiv, förordning, EPBD, EU]

agents:
  routing:
    # Deterministic core
    ingest_scripts: CODEFACTORY
    canonical_mapping: CODEFACTORY
    compute_engine: CODEFACTORY
    schema_and_validation: CODEFACTORY
    manifest_and_hash_integration: CODEFACTORY
    tests_and_golden_fixtures: CODEFACTORY

    # Scaffolding only
    scaffolding_routes_and_wiring: QWEN_LOCAL

    # UI/Docs only
    ui_components: CLAUDE_API
    docs_and_methodology_text: CLAUDE_API

  constraints:
    CODEFACTORY:
      - "Must not invent data. All defaults that affect outputs must be evidence-backed or explicitly flagged as assumptions in canonical store."
      - "All compute changes require golden tests."
      - "All ingests must produce manifest.json + files.sha256 + root_hash.txt with stable ordering."

    QWEN_LOCAL:
      - "Scaffolding only: file/folder skeletons, empty handlers, exports."
      - "May not implement compute logic or embed domain constants."

    CLAUDE_API:
      - "Scope: apps/web/** and docs/** only."
      - "May generate React/Next UI and text, but MUST NOT write ingestion/compute/schema/manifest code."
      - "Must not hardcode domain values (EIC codes, tax rates, COP values, prices)."
      - "UI must read values from canonical store/API only."
      - "Every displayed metric must be linkable to evidence_id and/or manifest/root_hash."

  gates:
    - id: GATE_A_SCOPE_ENFORCEMENT
      rule: "Claude changes limited to apps/web/** and docs/**. Any change outside these paths must be rejected."
    - id: GATE_B_GOLDEN_TESTS
      rule: "Any change under packages/compute/** or affecting derived outputs must include/refresh golden tests."
    - id: GATE_C_NO_UI_CONSTANTS
      rule: "UI may not contain authoritative domain constants. Must load registries/canonical data."
    - id: GATE_D_MANIFEST_DISCIPLINE
      rule: "Every ingest run produces manifest.json + files.sha256 + root_hash.txt; reproducible given same inputs."

  files_policy:
    claude_allowlist:
      - "apps/web/**"
      - "docs/**"
    claude_denylist:
      - "packages/evidence/**"
      - "packages/compute/**"
      - "packages/schemas/**"
      - "scripts/**"
      - "manifests/**"
      - "data/**"

  language_strategy:
    witness_package: TypeScript
    evidence_scripts: Python (hash_tree.py, make_manifest.py)
    bridge: "TS calls Python via child_process.execSync"
