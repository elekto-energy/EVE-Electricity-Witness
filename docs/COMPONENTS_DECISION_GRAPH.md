# COMPONENTS_DECISION_GRAPH.md — Props contracts for Decision Graph UI
# Version: 1.0 — 2026-02-15
# Trinity routing: CLAUDE_API (UI components), types generated by CODEFACTORY

---

## 1. DecisionCard.tsx

**Purpose:** Single decision node in index feed.

```typescript
interface DecisionCardProps {
  node: {
    node_id: string;
    node_type: "prop" | "bet" | "vote" | "sfs_ref";
    title: string;
    published_at_utc: string;       // ISO 8601
    dok_id?: string;                 // Riksdagen dok_id
    votering_id?: string;            // For vote nodes
    riksmote: string;                // e.g. "2024/25"
    responsible_organ?: string;      // Department/committee
    topic_tags: string[];            // ["ENERGY.NUCLEAR"] etc
    source_url: string;              // Link to Riksdagen
    evidence_ref: {
      manifest_id: string;
      root_hash: string;
    };
  };
  onSelect?: (nodeId: string) => void;
  onEvidenceClick?: (nodeId: string) => void;
}
```

**Renders:**
- Type badge (PROP/BET/VOTE/SFS) with color coding
- Title (clickable → detail page)
- Date + riksmöte
- Topic tags
- Responsible organ badge
- EvidenceBadge
- "Källa →" link

---

## 2. DecisionChain.tsx

**Purpose:** Vertical timeline of connected decision nodes (center column on detail page).

```typescript
interface DecisionChainProps {
  /** The focal node */
  focal: DecisionCardProps["node"];
  /** Edges going out from focal */
  edges_out: DecisionEdge[];
  /** Edges coming in to focal */
  edges_in: DecisionEdge[];
  /** All neighbor nodes (resolved) */
  neighbors: DecisionCardProps["node"][];
  /** Max depth shown */
  depth: number; // default 2
  onNodeSelect?: (nodeId: string) => void;
  onEdgeClick?: (edgeId: string) => void;
}

interface DecisionEdge {
  edge_id: string;
  from_node_id: string;
  to_node_id: string;
  edge_type: "references" | "leads_to" | "implements";
  evidence_ref: {
    manifest_id: string;
    root_hash: string;
  };
}
```

**Renders:**
- Vertical timeline with focal node highlighted
- Incoming nodes above, outgoing below
- Edge labels between nodes (clickable)
- Depth toggle (1-4)

---

## 3. LinkedStatementsPanel.tsx

**Purpose:** Right panel on detail page. Shows statements linked to a decision.

```typescript
interface LinkedStatementsPanelProps {
  decisionNodeId: string;
  /** Pre-fetched or lazy-loaded */
  links?: LinkedStatement[];
  evidence?: {
    statements: { manifest_id: string; root_hash: string };
    links: { manifest_id: string; root_hash: string };
  };
  onStatementClick?: (statementId: string) => void;
}

interface LinkedStatement {
  link_id: string;
  statement_id: string;
  speaker_name: string;
  speaker_party: string | null;
  source_type: string;          // primary_parliament etc
  published_at_utc: string;
  excerpt: string;              // max 200 chars
  original_url: string;
  matched_by: {
    rule_id: string;
    rule_type: "explicit_id_reference" | "dok_id_match" | "sfs_number_match" | "keyword_regex_strict";
    matched_text?: string;      // max 80 chars
  };
}
```

**Renders:**
- Header: "Linked Statements (N)"
- List of mini statement cards:
  - Speaker + party badge
  - Date + source badge
  - Excerpt (truncated)
  - "Matched by: [rule_type] — [matched_text]" in muted text
- Empty state: "No statements linked to this decision yet."
- EvidenceBadge for links dataset

---

## 4. DecisionFilters.tsx

**Purpose:** Filter bar for /witness/decisions index.

```typescript
interface DecisionFiltersProps {
  topic: string;
  onTopicChange: (t: string) => void;
  nodeType: string;               // "" | "prop" | "bet" | "vote" | "sfs_ref"
  onNodeTypeChange: (t: string) => void;
  from: string;
  onFromChange: (d: string) => void;
  to: string;
  onToChange: (d: string) => void;
  search: string;
  onSearchChange: (q: string) => void;
}
```

**Renders:**
- Topic dropdown (v1: only "Energy", "All")
- Type dropdown (All / Prop / Bet / Vote / SFS-ref)
- Date range inputs
- Search input (title/dok_id)

---

## 5. VoteSummary.tsx

**Purpose:** Aggregated vote result for a vote node.

```typescript
interface VoteSummaryProps {
  voteId: string;
  betRef: string;                  // e.g. "NU12"
  point: string;                   // e.g. "1"
  result: {
    party: string;
    ja: number;
    nej: number;
    avstar: number;
    franvarande: number;
  }[];
  totalJa: number;
  totalNej: number;
  totalAvstar: number;
  evidence_ref: {
    manifest_id: string;
    root_hash: string;
  };
}
```

**Renders:**
- Horizontal bar chart (Ja/Nej/Avstår) per party
- Total counts
- Bet reference + punkt
- EvidenceBadge

---

## 6. EvidenceDrawer.tsx (existing, extend)

**Already exists.** Extend to handle DecisionNode evidence:

```typescript
// Add to existing EvidenceDrawer props union:
interface DecisionEvidenceDrawerProps {
  open: boolean;
  onClose: () => void;
  node?: DecisionCardProps["node"];    // If showing decision evidence
  edge?: DecisionEdge;                 // If showing edge evidence
  link?: LinkedStatement;              // If showing link evidence
}
```

---

## Shared types location

All types above should be generated in:
- `apps/web/lib/types/decisions.ts` (DecisionNode, DecisionEdge, VoteSummary)
- `apps/web/lib/types/linking.ts` (LinkedStatement, LinkRule)
- Existing: `apps/web/lib/types/statements.ts` (no changes)

## Fixture contract

Golden test fixtures should include:
- 3 decision nodes (1 prop, 1 bet, 1 vote) with edges
- 5 linked statements (2 by dok_id_match, 1 by sfs_number, 2 by keyword)
- 1 vote summary with 3 parties
- All with evidence_ref filled

File: `apps/web/lib/decisions/__tests__/fixtures/decision_graph_golden.json`

## Color coding (consistent with existing design)

| Node type | Badge color | Notes |
|-----------|-------------|-------|
| PROP | `--accent-blue` | Blue = government proposal |
| BET | `--accent-purple` (#a78bfa) | Purple = committee work |
| VOTE | `--accent-green` | Green = democratic decision |
| SFS-ref | `--accent-amber` (#f59e0b) | Amber = law reference |

| Edge type | Line style | Notes |
|-----------|------------|-------|
| references | solid | Direct reference |
| leads_to | dashed | Process flow |
| implements | dotted | Law implementation |
